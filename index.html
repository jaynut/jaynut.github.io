
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="Author" content="Jayant Ravindra">
<meta name="KeyWords" content="SVG Spirograph Animated">
<!-- the original codebase provided by John Whitehouse, significantly modified to fit my purposes.  Thanks John! -->
<script>


var colours = [ "Black", "Navy","DarkBlue", "MediumBlue", "Blue", "DarkGreen", "Green", "Teal",
                "DarkCyan", "DeepSkyBlue", "DarkTurquoise", "MediumSpringGreen", "Lime", "SpringGreen",
                "Aqua", "Cyan", "MidnightBlue", "DodgerBlue", "LightSeaGreen", "ForestGreen", "SeaGreen",
                "DarkSlateGray", "LimeGreen", "MediumSeaGreen", "Turquoise", "RoyalBlue", "SteelBlue",
                "DarkSlateBlue", "MediumTurquoise", "Indigo  ", "DarkOliveGreen", "CornflowerBlue",
                "MediumAquaMarine", "DimGray", "SlateBlue", "OliveDrab", "SlateGray", "LightSlateGray",
                "MediumSlateBlue", "LawnGreen", "Chartreuse", "Aquamarine", "Maroon", "Purple", "Olive",
                "Gray", "SkyBlue", "LightSkyBlue", "BlueViolet", "DarkRed", "DarkMagenta", "SaddleBrown",
                "DarkSeaGreen", "LightGreen", "MediumPurple", "DarkViolet", "PaleGreen", "DarkOrchid",
                "YellowGreen", "Sienna", "Brown", "DarkGray", "LightBlue", "GreenYellow", "PaleTurquoise",
                "LightSteelBlue", "PowderBlue", "FireBrick", "DarkGoldenRod", "MediumOrchid", "RosyBrown",
                "DarkKhaki", "Silver", "MediumVioletRed", "IndianRed ", "Peru", "Chocolate", "Tan",
                "LightGray", "Thistle", "Orchid", "GoldenRod", "PaleVioletRed", "Crimson", "Gainsboro",
                "Plum", "BurlyWood", "LightCyan", "Lavender", "DarkSalmon", "Violet", "PaleGoldenRod",
                "LightCoral", "Khaki", "AliceBlue", "HoneyDew", "Azure", "SandyBrown", "Wheat", "Beige",
                "WhiteSmoke", "MintCream", "GhostWhite", "Salmon", "AntiqueWhite", "Linen", "LightGoldenRodYellow",
                "OldLace", "Red", "Fuchsia", "Magenta", "DeepPink", "OrangeRed", "Tomato", "HotPink", "Coral",
                "DarkOrange", "LightSalmon", "Orange", "LightPink", "Pink", "Gold", "PeachPuff",
                "NavajoWhite", "Moccasin", "Bisque", "MistyRose", "BlanchedAlmond", "PapayaWhip",
                "LavenderBlush", "SeaShell", "Cornsilk", "LemonChiffon", "FloralWhite", "Snow", "Yellow",
                "LightYellow", "Ivory", "White", "#aabbcc"];

// Constants

var max_wheels = 20;
var min_wheels = 1;
var min_points = 3;
var max_points = 100000;
var min_size = 30;
var max_size = 10000;
var max_wheel_size = 1000;
var min_wheel_size = -1000;
var max_thickness = 300;
var save_table = "";
var polarize = true;
//-------------------------------------------------------------------------------------------------
// define the spirograph object
//-------------------------------------------------------------------------------------------------
function Spirograph ()
{
    this.num_wheels = 5;
    this.num_points = 50000;
    this.size = 1400;
	this.thickness = 1;

    this.wheel_sizes = [];
    this.wheel_rates = [];
    this.wheel_phases = [];
    this.phase_deltas = [];
    this.wheel_states = [];
	this.pointsRad = [];
	this.pointArray = [];
    this.output_string = "";
    
    
    this.save_text = "";

    this.line_colour = "black";
	this.line_colour2 = "red"
    this.fill_colour = "yellow";
    this.fill_rule = "evenodd";
    this.randomiser = "None";
}
//-------------------------------------------------------------------------------------------------
// Copy an existing spirograph object
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.Copy = function (spirograph)
{
    this.num_wheels = spirograph.num_wheels;
    this.num_points = spirograph.num_points;
    this.line_colour = spirograph.line_colour;
    this.fill_colour = spirograph.fill_colour;
    this.fill_rule = spirograph.fill_rule;
    this.randomiser = spirograph.randomiser;

    for (i = 0 ; i < max_wheels ; i++)
    {
        this.wheel_sizes [i] = spirograph.wheel_sizes [i];
        this.wheel_rates [i] = spirograph.wheel_rates [i];
        this.wheel_phases [i] = spirograph.wheel_phases [i];
        this.phase_deltas [i] = spirograph.phase_deltas [i];
    }
}

//-------------------------------------------------------------------------------------------------
// Draw the spirograph
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.Draw = function (element_name)
{
    var element = document.getElementById(element_name);
	var points = []; //points array for svg-ing
	var segCounter = 0; //points indexing
	var quad = [];
    if (element != null)
    {
        radius = 0;
        phases = [0,0,0,0,0];

        // Calculate total radius and convert phases to radians

        for (i = 0 ; i < this.num_wheels ; i++)
        {
            radius += Math.abs (this.wheel_sizes [i]);
            phases [i] = this.wheel_phases [i] * Math.PI / 180;
        }

        w = this.size / 2;

        factor = (w - 10) / radius;

        var k = 2 * Math.PI / (this.num_points-1);

        svgheader = "<svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\"";
		if(polarize){
        svgheader += " width=\"" + this.size + "\" height=\"" + this.size + "\"";
        svgheader += " viewBox=\"" + -w + "," + -w + "," + 2*w + "," + 2*w + "\">";
		}
		else{
		svgheader += " width=\"" + this.size  + "\" height=\"" + this.size + "\"";
        svgheader += " viewBox=\"" + 0 + "," + 0 + "," + 4*w + "," + 4*w + "\">";
		
		
		}
        points[segCounter] = "";
		var moveTo = true;
        for (i = 0 ; i < this.num_points ; i++)
        {
            a = i * k;
            x = 0.0;
            y = 0.0;

            for (j = 0 ; j < this.num_wheels ; j++)
            {
			
                a2 = a * this.wheel_rates [j] + phases [j];
                x += this.wheel_sizes [j] * Math.sin (a2);// + a2;
                y += this.wheel_sizes [j] * Math.cos (a2);
            }
			
		
			
			x = x * factor;
            y = y * factor;
			
            
			
			//console.log(this.pointsRad[i]);
			if(polarize){
				if(moveTo)
				{
					points[segCounter] += "M " + x + "," + y  + " ";
					moveTo = false;
				}
				else
				{
				points[segCounter] += "L " + x + "," + y  + " ";
				}
			}
			else{
			
			this.pointArray[i] = Math.pow(Math.sqrt(x*x + y*y),.8)*5
			
			if(x < 0)
				{
			if(y <= 0){
				quad[i] = 3;
			}
			else
			{
				quad[i] = 2;
			}
			
			this.pointsRad[i] = (Math.atan(y/x) + Math.PI)*((this.size)/Math.PI)
			
			}
			else if(y <= 0)
			{
			
			quad[i] = 4;
			this.pointsRad[i] = (Math.atan(y/x) + 2*Math.PI)*((this.size)/Math.PI)		
			
			}
			else
			{
			quad[i] = 1;
				this.pointsRad[i] = Math.atan(y/x)*((this.size)/Math.PI)
			}
			
			if(i == this.num_points-1) {
			this.pointsRad[i] = this.pointsRad[0];
			this.pointArray[i] = this.pointArray[0];
			
			}
			
			if(i != 0 && ((quad[i-1] == 4 && quad[i] == 1) || (quad[i-1] == 1 && quad[i] == 4)))
				{
				
						
					if(quad[i] == 1)
						points[segCounter] += "L " + (this.pointsRad[i] + (2*this.size)) + "," + this.pointArray[i]  + " ";
					else
						points[segCounter] += "L " + (this.pointsRad[i] - (2*this.size)) + "," + this.pointArray[i]  + " ";
					
					++segCounter;
					
					if(quad[i-1] == 1)
						points[segCounter] = "M " + (this.pointsRad[i-1] + (4*w)) + "," + this.pointArray[i-1]  + " ";
					else
						points[segCounter] = "M " + (this.pointsRad[i-1] - (4*w)) + "," + this.pointArray[i-1]  + " ";
					
					
				}
			if(moveTo)
				{
				points[segCounter] = "M " + this.pointsRad[i] + "," + this.pointArray[i]  + " ";
				moveTo = false;
				}
			else{
				points[segCounter] += "L " + this.pointsRad[i] + "," + this.pointArray[i]  + " ";
			
				}
			}
        }
		
		
		textSummation = "";
		for(k = 0; k < segCounter+1; k++){
		//console.log(this.wheel_rates)
        text = "<path d=\"" + points[k];
		
		if(polarize) text += " Z ";
		
        text += "\" style=\"";
        text += "fill:" + "none" + ";";
        //text += "fill-rule:" + this.fill_rule + ";";
		textclone = text;
		text += "stroke:" + this.line_colour + ";";
		text+="stroke-width:" + this.thickness + "\"";

        text += "\"/>"
		
		textclone += "stroke:" + this.line_colour2 + ";";
		textclone += "stroke-width:" + (this.thickness * .5) + " \" />"
		textSummation += text + textclone;
		
		}
		
		//console.log(textSummation);
		
        element.innerHTML = svgheader + textSummation +  + "</svg>" ;
    }
}

Spirograph.prototype.HideUnusedWheels = function(delta)
{
	
	
	
	if(delta > 0)
			document.getElementById("wheel" + (this.num_wheels)).style.display = 'table-cell';
		
	else
		document.getElementById("wheel" + (this.num_wheels+1)).style.display = 'none';
	
	
	
	
	
	
}
//-------------------------------------------------------------------------------------------------
// Increase the number of points used to draw the spirograph
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.IncrementPoints = function (delta)
{
    this.num_points += delta;

    if (this.num_points < min_points) this.num_points = min_points;
    if (this.num_points > max_points) this.num_points = max_points;
	
	document.getElementById("points_change").value = this.num_points;
}
//-------------------------------------------------------------------------------------------------
// Increase the number of wheels used to construct the pattern
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.IncrementWheels = function (delta)
{
	
	
    this.num_wheels += delta;

	
    if (this.num_wheels < min_wheels) this.num_wheels = min_wheels;
    if (this.num_wheels > max_wheels) this.num_wheels = max_wheels;
	
	document.getElementById("wheel_change").value = this.num_wheels;
	
    spirograph.HideUnusedWheels(delta);
    
    
}

Spirograph.prototype.changeWheels = function ()
{
	
	number = Number(document.getElementById("wheel_change").value);
	orig_num_wheels = this.num_wheels;
	
	if (number < min_wheels) number = min_wheels;
	
    if (number > max_wheels) number = max_wheels;
	
	
	if(number < this.num_wheels){
		for(i = 0; i < orig_num_wheels - number; i++)
		{
			this.IncrementWheels(-1);
		}
		}
	else if(number > this.num_wheels){
		for(i = 0; i < number - orig_num_wheels; i++)
		{

			this.IncrementWheels(1);
		}
		}


    
    
}
//-------------------------------------------------------------------------------------------------
// Set the fill colour
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.SetFillColour = function (colour)
{
    this.fill_colour = colour;
}
//-------------------------------------------------------------------------------------------------
// Set the fill colour
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.SetFillRule = function (rule)
{
    this.fill_rule = rule;
}
//-------------------------------------------------------------------------------------------------
// Set the fill colour
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.SetSize = function (new_size)
{
	
	//console.error(new_size); //gives you the red errormessage
	//console.log(new_size); //gives the default message
	//console.warn(new_size); //gives the warn message with the exclamation mark in front of it
	//console.info(new_size); //gives an info message with an 'i' in front of the message
	
	//alert("" + new_size);
	
    if (new_size >= min_size && new_size <= max_size)
    {
        this.size = new_size;
    }
}
//-------------------------------------------------------------------------------------------------
// Set the fill colour
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.IncrementSize = function (delta)
{
    new_size = this.size + delta;

    if (new_size > 0)
    {
        this.SetSize (this.size + delta);
    }
	document.getElementById("size_change").value = this.size;
}
//-------------------------------------------------------------------------------------------------
// Update a wheel's size
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.SetWheelSize = function (wheel, delta)
{

	this.wheel_sizes[wheel] += delta;
	document.getElementById("wheelSize_change" + wheel).value = Number(spirograph.wheel_sizes[wheel]);
       
}
//-------------------------------------------------------------------------------------------------
// Update a wheel's rate
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.SetWheelRate = function (wheel, delta)
{
    this.wheel_rates[wheel] += delta; 
	document.getElementById("wheelRate_change" + wheel).value = spirograph.wheel_rates[wheel];
}
//-------------------------------------------------------------------------------------------------
// Update a wheel's phase
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.SetWheelPhase = function (wheel, delta)
{
	this.wheel_phases[wheel] += delta;
	document.getElementById("wheelPhase_change" + wheel).value = spirograph.wheel_rates[wheel];
	
}
//-------------------------------------------------------------------------------------------------
// Animate the wheel phases
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.Animate = function ()
{
	 for (wheel = 0 ; wheel < max_wheels ; ++wheel)
    {
		if(document.getElementById("animate"+ (wheel+1)).checked == true)
		{
			this.SetWheelPhase (wheel, this.phase_deltas [wheel]);
			document.getElementById("wheelPhase_change" + wheel).value = spirograph.wheel_phases[wheel];
		}
    }

	
}


Spirograph.prototype.AnimateWheelSize = function ()
{
	limit = 0;
	do{
	wheel = RandomInteger(this.num_wheels)
	if(limit++ == 5) return;
	}
    while(document.getElementById("animate" + (wheel+1)).checked == false); 
	
    if((this.wheel_sizes[wheel] >= max_wheel_size) || this.wheel_sizes[wheel] <= min_wheel_size)
    {
    		this.wheel_states[wheel] *= -1;
    }
   	this.SetWheelSize (wheel, this.wheel_states[wheel]);
    
}




//-------------------------------------------------------------------------------------------------
// Increase/decrease the symmetry of the pattern
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.IncrementSymmetry = function (delta)
{
    symm = this.GetSymmetry ();

    if (symm == 0) return;
    if (symm < 0) symm = - symm;

    symm += delta;

    if (symm > 1)
    {
        this.EnforceSymmetry (symm, 1);
    }
}
//-------------------------------------------------------------------------------------------------
// Adjust wheels 2-N to make the pattern symetrical
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.MakeSymmetrical = function ()
{
    symm = this.GetSymmetry ();

    this.EnforceSymmetry (symm, 2);
}
//-------------------------------------------------------------------------------------------------
// Make an example pattern
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.MakeExample = function ()
{
    this.num_wheels = 2;
    this.num_points = 298;
    this.wheel_rates [0] = 6;
    this.wheel_rates [1] = 79;
    this.line_colour = "black";
    this.fill_colour = "blue";
    this.fill_rule = "evenodd";
}
//-------------------------------------------------------------------------------------------------
// Randomise the number of wheels
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.RandomiseWheels = function ()
{
    this.randomiser = "Wheels";

    if (this.num_wheels == min_wheels)
    {
        this.num_wheels += 1;
    }
    else if (this.num_wheels == max_wheels)
    {
        this.num_wheels -= 1;
    }
    else
    {
        this.num_wheels += (Math.random () > 0.5) ? 1 : -1;
    }
}
//-------------------------------------------------------------------------------------------------
// Randomise the number of points
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.RandomisePoints = function (increase)
{
    this.randomiser = "Points";

    if (increase === false)
    {
        this.IncrementPoints (- RandomInteger (501));
    }
    else if (increase === true)
    {
        this.IncrementPoints (RandomInteger (501));
    }
    else
    {
        var n = RandomInteger (4);
        var points = Math.floor (Math.random () * Math.pow (10, n+1));

        this.num_points = Math.max (min_points, Math.min (max_points, points));
    }
}
//-------------------------------------------------------------------------------------------------
// Randomise the size of a wheel
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.RandomiseWheelSize = function ()
{
    var wheel = RandomInteger (this.num_wheels);

    this.randomiser = "Wheel-size " + wheel;
    this.SetWheelSize (wheel, RandomInteger (5) - 2);
}
//-------------------------------------------------------------------------------------------------
// Randomise the rate of a wheel
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.RandomiseWheelRate = function ()
{
    var wheel = RandomInteger (this.num_wheels);

    randomiser = "Wheel-rate " + wheel;
    this.SetWheelRate (wheel, RandomInteger (5) - 2);
}
//-------------------------------------------------------------------------------------------------
// Randomise the phase of a wheel
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.RandomiseWheelPhase = function ()
{
    var wheel = RandomInteger (this.num_wheels);

    this.randomiser = "Wheel-phase " + wheel;
    this.SetWheelPhase (wheel, RandomInteger (360));
}
//-------------------------------------------------------------------------------------------------
// Randomise the fill colour
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.RandomiseFillColour = function ()
{
    var c = RandomInteger (colours.length);

    this.randomiser = "Fill colour";
    this.fill_colour = colours [c];
}
//-------------------------------------------------------------------------------------------------
// Randomise the line colour
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.RandomiseLineColour = function ()
{
    this.randomiser = "Line colour";

    if (this.fill_colour == "None" || this.line_colour != "black")
    {
        this.line_colour = "black";
    }
    else
    {
        this.line_colour = this.fill_colour;
    }
}

/*
Output String Generation
*/
Spirograph.prototype.SaveString = function()
{

save_table += this.output_string ;

	
	
	
}



Spirograph.prototype.GenerateOutputString = function()
{
	
	var outputString = "\"000:000:9000:00" + this.num_wheels + ":";

	var dummyWheelSize = "(";
	var dummyWheelRate = "(";
	var dummyWheelPhase = "(";
	
	for(wheel = 0; wheel < this.num_wheels; wheel++){
		
		dummyWheelSize += this.wheel_sizes[wheel];
		dummyWheelRate += this.wheel_rates[wheel];
		dummyWheelPhase += this.wheel_phases[wheel];

		
		
		
		if(wheel < (this.num_wheels-1))
		{
			dummyWheelSize += (",");
			dummyWheelRate += ",";
			dummyWheelPhase += ",";
		}
		else
		{
			dummyWheelSize += ")";
			dummyWheelRate += ")";
			dummyWheelPhase += ")";
		}
		
		
	}
	
	outputString += dummyWheelSize + dummyWheelRate + dummyWheelPhase + "\", \r\n";
	
	this.output_string = outputString;
	
	
	}

//-------------------------------------------------------------------------------------------------
// Randomise the fill mode
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.RandomiseFillMode = function ()
{
    this.randomiser = "Fill rule";

    var mode = RandomInteger (2);

    switch (mode)
    {
        case 0:
            this.fill_rule = (this.fill_rule == "nonzero") ? "evenodd" : "nonzero";
            break;

        case 1:

            if (this.fill_colour == "None")
            {
                var c = RandomInteger (colours.length);
                this.fill_colour = colours [c];
            }
            else
            {
                this.fill_colour = "None";
            }
            break;
    }
}
//-------------------------------------------------------------------------------------------------
// Randomise the phase deltas
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.RandomisePhaseDeltas = function ()
{
    this.randomiser = "Phase deltas";

    for (wheel = 0 ; wheel < this.num_wheels ; ++wheel)
    {
        while((this.phase_deltas[wheel] = RandomInteger(11)-5) == 0);
    }
}
//-------------------------------------------------------------------------------------------------
// Randomise - takes a single attribute and randomises it
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.Randomise = function ()
{
    option = Math.floor (Math.random() * 13);

    switch (option)
    {
        case 0:
            this.RandomiseWheels ();
            break;

        case 1:
            this.RandomisePoints ();
            break;

        case 2:
            this.RandomiseWheelSize ();
            break;

        case 3:
            this.RandomiseWheelRate ();
            break;

        case 4:
            this.RandomiseWheelPhase ();
            break;

        case 5:
            this.RandomiseFillColour ();
            break;

        case 6:
            this.RandomiseLineColour ();
            break;

        case 7:
        case 9:
            this.RandomiseFillMode ();
            break;

        case 8:
            this.randomiser = "Make Symmetrical";
            symm = this.GetSymmetry ();
            this.EnforceSymmetry (symm, 2);
            break;

        case 10:
            this.RandomisePhaseDeltas ();
            break;

        case 11:
            this.randomiser = "Symmetry + 1";
            this.IncrementSymmetry (1);
            break;

        case 12:
            this.randomiser = "Symmetry - 1";
            this.IncrementSymmetry (-1);
            break;

        default:
            this.randomiser = option;
            break;
    }
}
//-------------------------------------------------------------------------------------------------
// Display the current settings
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.DisplaySaveTable = function(element_name)
{
	
	
	var element = document.getElementById(element_name);
	this.save_text = save_table
	element.innerHTML = "<text>" + this.save_text + "</text>";
}



Spirograph.prototype.DisplaySettings = function(element_name)
{
	this.GenerateOutputString();
	var element = document.getElementById(element_name);

    if (element != null)
    {
        sizes = "";
        rates = "";
        phases = "";
        phase_deltas = "";

        for (i = 0 ; i < this.num_wheels ; ++i)
        {
            if (i != 0)
            {
                sizes += ", ";
                rates += ", ";
                phases += ", ";
                phase_deltas += ", ";
            }
            sizes += this.wheel_sizes [i];
            rates += this.wheel_rates [i];
            phases += this.wheel_phases [i];
            phase_deltas += this.phase_deltas [i];
        }

        text = "<table style=\"overflow: auto; font-family: Courier New;  font-size: 110%; color: black\">";

        text += "<tr><td>Num wheels:</td><td>" + this.num_wheels + "</td></tr>";
        text += "<tr><td>Num points:</td><td>" + this.num_points + "</td></tr>";
        text += "<tr><td>Wheel sizes:</td><td>" + sizes + "</td></tr>";
        text += "<tr><td>Wheel rates:</td><td>" + rates + "</td></tr>";
        text += "<tr><td>Wheel phases:</td><td>" + phases + "</td></tr>";
        text += "<tr><td>Wheel phase deltas:</td><td>" + phase_deltas + "</td></tr>";
        text += "<tr><td>Line:</td><td>" + this.line_colour + "</td></tr>";
        text += "<tr><td>Fill:</td><td>" + this.fill_colour + "</td></tr>";
        text += "<tr><td>Fill rule:</td><td>" + this.fill_rule + "</td></tr>";
        text += "<tr><td>Size:</td><td>" + this.size + "</td></tr>";
        text += "<tr><td>Randomiser:</td><td>" + this.randomiser + "</td></tr>";
		text += "<tr><td>String:</td><td>" + this.output_string + "</td></tr>";
        
        text += "</table>";

        element.innerHTML = text;
    }
}
//-------------------------------------------------------------------------------------------------
// Get the symmetry
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.GetSymmetry = function()
{
   symm = this.wheel_rates [1] - this.wheel_rates [0];
   if (symm < 0) symm = -symm;
   div = hcf (symm, this.wheel_rates [0]);
   return symm / div;
}

Spirograph.prototype.resetHiddenWheels = function()
{
	
	for(j= 1; j < this.num_wheels + 1; j++)
	{
		document.getElementById("wheel" + (j)).style.display = 'table-cell';
	
	}
	for(j = this.num_wheels + 1; j < max_wheels+1; j++)
	{
		document.getElementById("wheel" + (j)).style.display = 'none';
	}
	
	
	
	
}

Spirograph.prototype.incrementThickness = function(delta)
{
this.thickness += delta;

if(this.thickness > max_thickness) {
	this.thickness = max_thickness;

}

document.getElementById("thickness_change").value = this.thickness;


}

Spirograph.prototype.changeThickness = function(newT)
{
this.thickness = newT;

if(this.thickness > max_thickness) {
	this.thickness = max_thickness;
}

document.getElementById("thickness_change").value = this.thickness;


}

//-------------------------------------------------------------------------------------------------
// Creates a pattern with the requested symmetry
//-------------------------------------------------------------------------------------------------
Spirograph.prototype.EnforceSymmetry = function(symm, first_wheel)
{
    // Make the number of points a multiple of the symmetry;

    temp = Math.floor ((this.num_points + symm - 1) / symm);
    this.num_points = temp * symm;

    // Adjust the wheels (1st two wheels define the symmetry)

    if (first_wheel == 1)
    {
        if (this.wheel_rates [1] > this.wheel_rates [0])
        {
            this.wheel_rates [1] = this.wheel_rates [0] + symm;
        }
        else
        {
            this.wheel_rates [1] = this.wheel_rates [0] - symm;
        }
    }

    // Elliminate degenerate patterns

    while (this.wheel_rates [0] == 0 || this.wheel_rates [1] == 0 || hcf (this.wheel_rates [1], this.wheel_rates [0]) > 1)
    {
        this.wheel_rates [0] += 1;
        this.wheel_rates [1] += 1;
    }

    // remaining wheels take the symmetry from the first two

    for (i = 2 ; i < this.num_wheels ; ++i)
    {
        delta = this.wheel_rates [i] - this.wheel_rates [0];
        temp = Math.floor ((delta + symm - 1) / symm);
        this.wheel_rates [i] = this.wheel_rates [0] + temp * symm;
    }
}
//-------------------------------------------------------------------------------------------------
// Get a random integer in the range (0 - n-1)
//-------------------------------------------------------------------------------------------------
function RandomInteger (n)
{
    ret = Math.floor (Math.random () * n);
    if (ret == n) ret = n-1;
    return ret;
}
//-------------------------------------------------------------------------------------------------
// Get the highest common factor
//-------------------------------------------------------------------------------------------------
function hcf (x, y)
{
    x = Math.round (x);
    y = Math.round (y);

    if (x == 0 || y == 0) return 1;

    if (x < 0) x = -x;
    if (y < 0) y = -y;

    return hcf2 (x, y)
}
function hcf2 (x, y)
{
    if (x == 1 || y == 1) return 1;
    if (x == y) return x;

    return (x > y) ? hcf2 (x-y,x) : hcf2 (x,y-x);
}
</script>

<style>
UL.outer {



	list-style-type: none;
	padding: 0px;
	margin-left: 6px;
	margin-right: 6px;
	margin-top: 6px;
	margin-bottom: 6px;
}

UL.inner {
	list-style-type: none;
	padding: 0px;
	margin-left: 6px;
	margin-right: 6px;
	margin-top: 6px;
	margin-bottom: 6px;
}

LI.outer {
	display: inline-block;
	border: 1px solid blue;
	margin-left: 12px;
	margin-right: 0px;
	margin-top: 12px;
	margin-bottom: 0px;
	padding: 0px;
}

LI.inner_heading {
	display: block;
	border: 0px;
	margin-left: 0px;
	margin-right: 0px;
	margin-top: 0px;
	margin-bottom: 0px;
	font-weight: bold;
	color: #A31777;
	padding: 0px;
}

LI.inner {
	display: block;
	border: 0px;
	margin-left: 12px;
	margin-right: 0px;
	margin-top: 0px;
	margin-bottom: 0px;
	padding: 0px;
}

input[type=checkbox] {
  zoom:1.5;
}

</style>

<script>
    var spirograph;
    var timer;
    var in_animation = 0;

    //-------------------------------------------------------------
    OnStart = function ()
    {
	str1 = ""
	str2 = ""
	str3 = ""
	str4 = ""
	split = max_wheels/4;
        for(i = 0; i < split; i++)
		{
		str1 += wheelBuilder(i);
		

		
		}
		
		for(i = split; i < 2*split; i++)
		{
		str2 += wheelBuilder(i);
		
		}
		
		for(i = 2*split; i < 3*split; i++)
		{
		str3 += wheelBuilder(i);
		}
		
		
		for(i = 3*split; i < max_wheels; i++)
		{
		str4 += wheelBuilder(i);
		}
		
		
		
		document.getElementById("row1").innerHTML = str1;
		document.getElementById("row2").innerHTML = str2;
		document.getElementById("row3").innerHTML = str3;
		document.getElementById("row4").innerHTML = str4;
		
		StartNew(true)
    }
    //-------------------------------------------------------------
    Show = function (what)
    {
        window.location = what;
    }
    //-------------------------------------------------------------
    function Redraw ()
    {
    		spirograph.Draw ('picture');
        spirograph.DisplaySettings ('details');
        spirograph.DisplaySaveTable('saveTable');
              
    }
    
    function ResetSaveList()
    {
    		save_table = "";
    		spirograph.DisplaySaveTable('saveTable');
    	
    }
    //-------------------------------------------------------------
    // Start/Reset
    //-------------------------------------------------------------
    function StartNew (drawBool)
    {
    	

		clearInterval(timer);
		
		in_animation = 0;
		
        spirograph = new Spirograph ();
		
		if(document.getElementById("import_string").value.length != 0)
		{

		for(i = 0; i < max_wheels; i++)
		{
					document.getElementById("animate" +(i+1)).checked = true;
					spirograph.wheel_sizes.push(RandomInteger(5)+10);
					spirograph.wheel_rates.push(RandomInteger(5) + 6);
					spirograph.wheel_phases.push(0);
					spirograph.phase_deltas.push(RandomInteger(5));
					spirograph.wheel_states.push(1);
					document.getElementById("wheelRate_change" + i).value = spirograph.wheel_rates[i];
					document.getElementById("wheelPhase_change" + i).value = spirograph.wheel_phases[i];
					document.getElementById("wheelSize_change" + i).value = spirograph.wheel_sizes[i];
		
						
		}
		ImportString();
		spirograph.resetHiddenWheels();
		
		
		
		}
		else{
		for(i = 0; i < max_wheels; i++)
		{
		
					document.getElementById("animate" +(i+1)).checked = true;
					spirograph.wheel_sizes.push(RandomInteger(5)+10);
					spirograph.wheel_rates.push(RandomInteger(5) + 6);
					spirograph.wheel_phases.push(0);
					spirograph.phase_deltas.push(RandomInteger(5));
					spirograph.wheel_states.push(1);
					document.getElementById("wheelRate_change" + i).value = spirograph.wheel_rates[i];
					document.getElementById("wheelPhase_change" + i).value = spirograph.wheel_phases[i];
					document.getElementById("wheelSize_change" + i).value = spirograph.wheel_sizes[i];
		
						
		}
		
		spirograph.resetHiddenWheels();
		
		
		
		document.getElementById("size_change").value = spirograph.size;
		document.getElementById("points_change").value = spirograph.num_points;
		document.getElementById("wheel_change").value = spirograph.num_wheels;
		document.getElementById("thickness_change").value = spirograph.thickness;
		
        
        if(drawBool) Redraw ();
		}
    }
    

    //-------------------------------------------------------------
    // Adjust the number of points
    //-------------------------------------------------------------
    function IncrementPoints (delta)
    {
        spirograph.IncrementPoints (delta);
        Redraw ();
    }
    //-------------------------------------------------------------
    // Adjust the number of wheels
    //-------------------------------------------------------------
    function IncrementWheels (delta)
    {
        spirograph.IncrementWheels (delta);
        Redraw ();
    }
    //-------------------------------------------------------------
    // Adjust the symmetry of the pattern
    //-------------------------------------------------------------
    function IncrementSymmetry (delta)
    {
        spirograph.IncrementSymmetry (delta);
        Redraw ();
    }
    //-------------------------------------------------------------
    // Adjust the size of the pattern
    //-------------------------------------------------------------
    function IncrementSize (delta)
    {
        spirograph.IncrementSize (delta);
        Redraw ();
    }
    //-------------------------------------------------------------
    // Adjust the rate of one of the wheels
    //-------------------------------------------------------------
    function SetWheelRate (wheel, delta)
    {
        spirograph.SetWheelRate (wheel, delta);
        Redraw ();
    }
    //-------------------------------------------------------------
    // Adjust the size of one of the wheels
    //-------------------------------------------------------------
    function SetWheelSize (wheel, delta)
    {
        spirograph.SetWheelSize (wheel, delta);
        Redraw ();
    }
    //-------------------------------------------------------------
    // Adjust the phase of one of the wheels
    //-------------------------------------------------------------
    function SetWheelPhase (wheel, delta)
    {
        spirograph.SetWheelPhase (wheel, delta);
        Redraw ();
    }
    //-------------------------------------------------------------
    // Set the fill colour of the pattern
    //-------------------------------------------------------------
    function SetFillColour (colour)
    {
        spirograph.SetFillColour (colour);
        Redraw ();
    }
    //-------------------------------------------------------------
    // Set the fill rule
    //-------------------------------------------------------------
    function SetFillRule (rule)
    {
        spirograph.SetFillRule (rule);
        Redraw ();
    }
    //-------------------------------------------------------------
    // Construct an example
    //-------------------------------------------------------------
    function Example ()
    {
        spirograph.MakeExample ();
        Redraw ();
    }
    
    function SaveSpirograph()
    {
    		spirograph.SaveString();
    		Redraw();
    }
    
    //-------------------------------------------------------------
    // Randomise one of the attributes of the current pattern
    //-------------------------------------------------------------
    function Randomise ()
    {
        spirograph.Randomise ();
        Redraw ();
    }
    //-------------------------------------------------------------
    // Make the current pattern symmetrical
    //-------------------------------------------------------------
    function MakeSymmetrical ()
    {
        spirograph.MakeSymmetrical ();
        Redraw ();
    }
    //-------------------------------------------------------------
    // Start the phase animations
    //-------------------------------------------------------------
    
    function StartAnimation ()
	{
    	
    	spirograph.RandomisePhaseDeltas();
    	/*
    		Changed Animate button to Start/Stop
    		Eliminated the Stop button
    	*/
		
		
    	
		if (in_animation == 1)
		{
			in_animation = 0;
			clearInterval(timer);
		}
		else
		{
			if (in_animation == 0)
			{
			
				
				
				timer = setInterval(AnimatePhase, 10);
				in_animation = 1;
			}
			else
			{
				spirograph.RandomisePhaseDeltas();
			}
		}
	}
    
    function StartAnimationWheels ()
	{
    	
  
    	/*
    		Changed Animate button to Start/Stop
    		Eliminated the Stop button
    	*/

		
		
		
		if (in_animation == 1)
		{
			in_animation = 0;
			clearInterval(timer);
		}
		else
		{
			if (in_animation == 0)
			{
			    	
				timer = setInterval(AnimateWheels, 10);
				in_animation = 1;
			}
			else
			{
				spirograph.RandomisePhaseDeltas();
			}
		}
	}
    
    
	//-------------------------------------------------------------
	// Start the phase animations
	//-------------------------------------------------------------
	//function StopAnimation()
	//{
	//	if (in_animation == 1)
	//	{
	//		in_animation = 0;
	//		clearInterval(timer);
	//	}
	//}
	//-------------------------------------------------------------
	// Increment the phase of one of the wheels
	//-------------------------------------------------------------
	function AnimateWheels()
	{
		spirograph.AnimateWheelSize();
		Redraw();
	}
	
	function AnimatePhase()
	{
		spirograph.Animate();
		Redraw();
	}
	
	function ChangeWheels()
	{
	spirograph.changeWheels();
	Redraw();
	}
	
	function IncrementThickness(delta)
	{
	spirograph.incrementThickness(delta);
	Redraw();
	
	}

	function ChangeThickness()
	{
		spirograph.changeThickness(Number(document.getElementById("thickness_change").value));

	
		Redraw();
	
	}
	
	function isEmpty(value)
	{
	return (value.length != 0)
	
	}
	
	function ImportString()
	{
		
		str = (document.getElementById("import_string").value).split(/[\:\(\)\(,\s"]/).filter(isEmpty);
		document.getElementById("wheel_change").value = str[3];
		spirograph.changeWheels();
		spirograph.num_points = str[2];
		
		document.getElementById("size_change").value = spirograph.size;
		document.getElementById("points_change").value = spirograph.num_points;
		document.getElementById("wheel_change").value = spirograph.num_wheels;
		
		for(i = 0; i < spirograph.num_wheels; i++){
		
		spirograph.wheel_sizes[i] = Number(str[4 + i]);
		spirograph.wheel_rates[i] = Number(str[4 + i + spirograph.num_wheels]);
		spirograph.wheel_phases[i] = Number(str[4 + i + spirograph.num_wheels * 2]);
		
		document.getElementById("wheelRate_change" + i).value = spirograph.wheel_rates[i];
		document.getElementById("wheelPhase_change" + i).value = spirograph.wheel_phases[i];
		document.getElementById("wheelSize_change" + i).value = spirograph.wheel_sizes[i];
		
		}
		
		

		Redraw();

		
	}
	
	function ChangeWheelRate(num){
		spirograph.wheel_rates[num] = Number(document.getElementById("wheelRate_change" + num).value);
		Redraw();
	}
	
	function Unpolarize(){
	polarize = !polarize;
	Redraw();

	}
	
	function ChangeWheelSize(num){
		spirograph.wheel_sizes[num] = Number(document.getElementById("wheelSize_change" + num).value);
		Redraw();
	}
	
	function ChangeWheelPhase(num){
		spirograph.wheel_phases[num] = Number(document.getElementById("wheelPhase_change" + num).value);
		Redraw();
	}

	function wheelBuilder(wheelNum)
	{
	
	wheelStr = 		"<li class=\"outer\" id=\"wheel" + (wheelNum + 1) + "\" style=\"display:table-cell\"> <ul class=\"inner\"><li class=\"inner_heading\">Wheel" + (wheelNum + 1) + "</li>";
	 
	wheelStr +=		"<li class=\"inner\">Rate:<button type=\"button\" onclick=\"SetWheelRate(" + wheelNum + ", -10)\"> << </button><button type=\"button\" onclick=\"SetWheelRate(" + wheelNum + ", -1)\"> < </button>  <input type=\"text\" id=\"wheelRate_change" + wheelNum + "\" type=\"number\" onchange=\"ChangeWheelRate(" + wheelNum + ")\" size=\"10\" /> <button type=\"button\" onclick=\"SetWheelRate(" + wheelNum + ", 1)\"> > </button><button type=\"button\" onclick=\"SetWheelRate(" + wheelNum + ", 10)\"> >></button></li>";
								
	wheelStr +=		"<li class=\"inner\">Size:<button type=\"button\" onclick=\"SetWheelSize(" + wheelNum + ", -10)\"><<</button><button type=\"button\" onclick=\"SetWheelSize(" + wheelNum + ", -1)\"> < </button> <input type=\"text\" id=\"wheelSize_change" + wheelNum + "\" type=\"number\" onchange=\"ChangeWheelSize(" + wheelNum + ")\" size=\"10\" /> <button type=\"button\" onclick=\"SetWheelSize(" + wheelNum + ", 1)\"> > </button><button type=\"button\" onclick=\"SetWheelSize(" + wheelNum + ", 10)\"> >> </button></li>";

	 
	//<input id="thickness_change" type="number" onchange="ChangeThickness()" />
								
	wheelStr +=		"<li class=\"inner\">Phase:<button type=\"button\" onclick=\"SetWheelPhase(" + wheelNum + ", -10)\"><<</button><button type=\"button\" onclick=\"SetWheelPhase(" + wheelNum + ", -1)\"> < </button>  <input type=\"text\" id=\"wheelPhase_change" + wheelNum + "\" type=\"number\" onchange=\"ChangeWheelPhase(" + wheelNum + ")\" size=\"10\" /> <button type=\"button\" onclick=\"SetWheelPhase(" + wheelNum + ", 1)\"> ></button><button type=\"button\" onclick=\"SetWheelPhase(" + wheelNum + ", 10)\"> >>  	</button><li>";
	
	
	wheelStr +=		"<label class=\"switch\">Animate Toggle:<input type=\"checkbox\" id = \"animate" + (wheelNum + 1) + "\" /></label></li></li></ul></li>"
	
	return wheelStr;
	//document.getElementById("row1").innerHTML = wheelStr;
	}
	
	function ChangeSize()
	{
		num = Number(document.getElementById("size_change").value);
		if(num < min_points)
		{
			num = min_size;
			document.getElementById("size_change").value = num;
		}
		else if(num > max_size)
		{
			num = max_points;
			document.getElementById("size_change").value = num;
		}
		spirograph.size = num;
		Redraw();
	}
	
	function ChangePoints()
	{
		num = Number(document.getElementById("points_change").value);
		
		if(num < min_points)
		{
			num = min_points;
			document.getElementById("points_change").value = num;
		}
		else if(num > max_points)
		{
			num = max_points;
			document.getElementById("points_change").value = num;
		}

		spirograph.num_points = Number(num);
			
		Redraw();
	}
	
	
</script>

</head>

<!-- Title -->

<body onload="OnStart ();">


	<div class="in2">
		<div class="box" style="overflow: auto; font-family: Courier New;  font-size: 180%; color: black">

			<!-- Buttons -->
			<div>
				
				
					<div style="display:table">					
					<li class="outer" style ="display:table-cell">
						<ul class="inner">
							<li class="inner_heading">Setup</li>

							<!-- Number of points -->

							<li class="inner">Points:

								<button type="button" onclick="IncrementPoints (-100)"><<<</button>

								<button type="button" onclick="IncrementPoints (-10)"><<</button>

								<button type="button" onclick="IncrementPoints (-1)"><</button>
								
								<input id="points_change" type="text" onchange="ChangePoints()" size="10"/>
								
								<button type="button" onclick="IncrementPoints(1)">></button>

								<button type="button" onclick="IncrementPoints(10)">>></button>

								<button type="button" onclick="IncrementPoints(100)">>>></button>
							</li>
							
							<li class="inner">Size:

								<button type="button" onclick="IncrementSize(-100)"><<</button>

								<button type="button" onclick="IncrementSize(-10)"><</button>
								
								<input id="size_change" type="text" onchange="ChangeSize()" size="10" />

								<button type="button" onclick="IncrementSize(10)">></button>

								<button type="button" onclick="IncrementSize(100)">>></button>
							</li>
							
							
							<li class="inner">Thickness:

								

								<button type="button" onclick="IncrementThickness (-10)"><<</button>

								<button type="button" onclick="IncrementThickness (-1)"><</button>

								<input id="thickness_change" type="text" onchange="ChangeThickness()" size="10" />
								
								<button type="button" onclick="IncrementThickness(1)">></button>

								<button type="button" onclick="IncrementThickness(10)">>></button>

							</li>

							<!-- Number of Wheels -->

							<li class="inner">Wheels:

								<button type="button" onclick="IncrementWheels(-1)"><</button>
								
								<input id="wheel_change" type="text" onchange="ChangeWheels()"  size="10"/>

								<button type="button" onclick="IncrementWheels(1)">></button>
							</li>

							<!-- Symmetry -->

							<li class="inner">Symmetry:

								<button type="button" onclick="IncrementSymmetry(-1)"><</button>

								<button type="button" onclick="IncrementSymmetry(1)">></button>

							</li>
							
							<li class="inner">Import String:
							<input id="import_string" type="string" size = "75" onchange="ImportString(true)" />
							</li>
						</ul>
					</li>

					<!-- Some additional options -->

					<li class="outer" >
						<ul class="inner">

							<li class="inner">

								<button type="button" onclick="Example()">Example</button>
								<button type="button" onclick="Randomise()">Randomise</button>
								<button type="button" onclick="MakeSymmetrical()">Make
									symmetrical</button>
								<button type="button" onclick="StartAnimation()">Phase Animate</button>
								<button type="button" onclick="StartAnimationWheels()">Wheel Animate</button>
								
								<button type="button" onclick="SaveSpirograph()">Save String</button>
								<button type="button" onclick="ResetSaveList()">Rest Save List</button>
								
								<button type="button" onclick="StartNew(true)">Reset</button> 
								<button type="button" onclick="Unpolarize()">Unpolarize</button> 
							</li>
						</ul>
					</li>
				</div>
					
			</div>

			<div style="float: left;">

			<li style="display:table">
				<ul class="outer" style ="display:table-row" id="row1"></ul>
				<ul class="outer" style ="display:table-row" id="row2"></ul>
				<ul class="outer" style ="display:table-row" id="row3"></ul>
				<ul class="outer" style ="display:table-row" id="row4"></ul>
			</li>
			

			<!-- Picture and details -->

			<div style="clear: both;">
			
			
			<div>
			<div id="picture" style="float:left"></div>
			<!-- <div id="details" style="float: right"></div> -->
			<div id="saveTable" ></div>
			</div>
		</div>
	</div>

</body>
</html>
